#!/bin/bash

# Usage
#   gen-ap < INPUT > OUTPUT

# Generate assembly program from input
# The input is read byte by byte and each byte is converted to a .byte directive

while $1; do
    case $1 in
        -h|--help)
            echo "Usage: gen-ap < INPUT > OUTPUT"
            exit 0
            ;;
        *)
            echo "Unknown option: $1"
            exit 1
            ;;
    esac
done


echo "# Autogenerated by scripts/gen-ap"
echo "__ap_begin:"

while read -n 1 byte; do
    ord=$(printf "%b" "${byte:-\000}" |
          od -t x1 |
          { read offset hex; echo $hex; })
    echo ".byte $ord"
done

echo "__ap_end:"
